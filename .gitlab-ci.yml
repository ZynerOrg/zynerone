stages:
  - matrix

Matrix:
  stage: matrix
  image: ubuntu:latest
  parallel:
    matrix:
      - images:
          - "acme-zynerone"
          - "clamd-zynerone"
          - "dockerapi-zynerone"
          - "dovecot-zynerone"
          - "netfilter-zynerone"
          - "olefy-zynerone"
          - "php-fpm-zynerone"
          - "postfix-zynerone"
          - "rspamd-zynerone"
          - "sogo-zynerone"
          - "solr-zynerone"
          - "unbound-zynerone"
          - "watchdog-zynerone"
          - "api-zynerone"
  script:
    - apt update
    - apt install -y curl
    - curl -sSL https://get.docker.com/ | CHANNEL=stable sh
    - service docker start
    - echo $DOCKERHUB_TOKEN | docker login --username $DOCKERHUB_USERNAME --password-stdin
    - cp helper-scripts/docker-compose.override.yml.d/BUILD_FLAGS/docker-compose.override.yml docker-compose.override.yml
    - docker compose build ${images}
    - docker compose push ${images}
